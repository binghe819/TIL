<img src="./image/800x0.png" width="250" />

[토비의 스프링](http://www.yes24.com/Product/Goods/76074405?OzSrank=2)을 바탕으로 작성한 자료입니다.





# 목차





# 1장 오브젝트와 의존관계

스프링은 자바를 기반으로 한 기술이다.  

스프링이 가장 관심을 많이 두는 대상은 ***객체***다. 스프링을 이해하려면 먼저 객체에 깊은 관심을 가져야 한다.

***1장에서는 스프링이 어떤 것이고, 무엇을 제공하는지보다는 스프링이 관심을 갖는 대상인 객체의 설계와 구현, 동작원리에 더 집중한다.***



## 1 초난감 DAO

사용자 정보를 JDBC API를 통해 DB에 저장하고 조회할 수 있는 간단한 DAO를 만드는 예시를 보여준다.

![image-20200829215309664](./image/image-20200829215309664.png)

[초난감 DAO 코드](https://github.com/binghe819/toby-spring-code/blob/master/Ch01/src/main/java/user/dao/UserDao.java)

위 코드를 보면 DAO가 혼자 북치고 장구치고 다 한다. 여러 관심사항으로 나눠보면 아래와 같다.

* "커넥션"에 대한 관심
* DB에 보낼 sql을 만들고 실행하는 관심
* 리소스를 반환하는 관심

:scream: 이렇게 한 코드에 여러 관심사항이 존재하면 ***중복***코드를 야기하며, 훗날 ***변경이 일어나게 된다면*** 굉장히 지저분한 코드가 된다.

  

## 2 DAO의 분리

🤔 관심사의 분리 

* **관심이 같은 것끼리는 모이게 하고, 관심이 다른 것은 가능한 한 따로 떨어져서 서로 영향을 주지 않도록 분리하는 것.**
* 변화도 한 곳에서 일어나게 해야한다.



### 2-1 중복 코드의 메서드 추출

🤔 메서드 추출 기법

* 공통의 기능을 담당하는 메서드로 중복된 코드를 뽑아내는 것을 말한다.

[메서드 추출 기법 코드]()

😎 독립적인 메서드로 추출함으로써 한 가지 **관심**에 ***변경이 일어나면*** 관심이 집중되는 코드만 수정해주면 된다.

* 위 코드에서는 `getConnection()`으로 **DB의 커넥션 관련 관심**을 분리한 것이다.



### 2-2 상속을 통한 확장

:scream: 문제점은 위 코드를 여러 업체에 제공하게 된다면, 업체마다 사용하는 DB가 다를 수도 있고, `userDao` 의 코드를 노출하기 싫을 수도 있다. 이때 추상화를 한다.

![image-20200830013247861](./image/image-20200830013247861.png)

[상속을 통한 확장 코드 - 팩토리 메서드 패턴](https://github.com/binghe819/toby-spring-code/blob/master/Ch01/src/main/java/user/dao/abstractUserDao.java)

😎 DB 커넥션에 대한 관심을 ***추상 메서드***로 제공함으로써, `userDao`에 대한 코드를 제공하지 않고, 각 업체마다 커넥션에 대한 관심을 따로 설정할 수 있게 되었다.

> 템플릿 메서드 패턴과 팩토리 메서드 패턴의 대한 정의는 [용어 정리](#용어-정리)를 참고하자.

👍 **`userDao`**는 ***어떤 기능을 사용한다는 데에만 관심을 집중***하면 되고, **서브 클래스**에서 **커넥션을 제공하면 되는 지에 대한 관심**을 갖는 것이다.

* `userDao` : 어떻게 데이터를 등록하고 가져올 것인가에 대한 관심 (핵심 기능)
* `NUserDao`, `DUserDao` : DB 연결 방법은 어떻게 할 것인가에 대한 관심 

<img src="./image/image-20200830021023433.png" width="700" />

:scream: 상속을 사용하는데 따르는 단점이 있다.

* 다중 상속을 허용하지 않는다.
* 상속을 통한 상하위 클래스의 관계는 생각보다 밀접하다.
  * 서브 클래스는 슈퍼클래스의 기능을 직접 사용가능하므로, 슈퍼 클래스 내부의 변경이 서브클래스의 수정을 불러올 수 있다.
* 해당 DB 커넥션을 생성하는 코드를 다른 `dao`클래스에 적용할 수 없다.





## 3 DAO의 확장





























# 용어 정리



## DAO

🤔 DAO란?

DAO (Data Access Object)는 **DB를 사용해 데이터를 조회하거나 조작하는 기능**을 전담하도록 만든 오브젝트를 말한다.





## 자바빈

🙋‍♂️ 자바빈은 두 가지 관례를 따라 만들어진 오브젝트를 가리킨다.

* 디폴트 생성자 : 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야 한다. 툴이나 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문에 필요하다.
* 프로퍼티 : 자바빈이 노출하는 이름을 가진 속성을 프로퍼티라고 한다. Getter / Setter를 사용해 수정 또는 조회할 수 있다.



## 리팩토링

🤔 리팩토링이란?

* 리팩토링은 기존의 코드를 ***외부의 동작방식에는 변화 없이 내부 구조를 변경***해서 재구성하는 작업 또는 기술을 말한다.

😎 리팩토링을 하면?

* 코드 내부의 설계가 개선되어 코드를 이해하기가 더 편해지고, 변화에 효율적으로 대응 할 수 있다.
* 결국 생산성이 올라가고, 코드의 품질은 높아지며, 유지보수하기 용이해지고, 견고하면서도 유연한 제품을 개발할 수 있다.

🤔 나쁜 냄새

* 리팩토링이 절실히 필요한 코드의 특징을 나쁜 냄새라고 부르기도 한다.
* 대표적으로 나쁜 냄새는 중복 코드다.



## 디자인 패턴

🤔 디자인 패턴이란?

* 디자인 패턴은 소트프웨어 설계 시 특정 상황에서 자주 만나는 문제를 해결하기 위해 사용할 수 있는 재사용 가능한 솔루션을 말한다.



## 템플릿 메서드 패턴

🤔 템플릿 메서드 패턴이란?

* Template : 견본, 본보기, 형판
* 슈퍼클래스에 기본적인 로직의 흐름 (커넥션 가져오기, SQL 생성, 실행, 반환)을 만들고, 그 기능의 일부를 추상 메서드로 만든뒤 서브클래스에서 이런 메서드를 필요에 맞게 구현해서 사용하도록 하는 방법
* 즉, ***상속을 통해 슈퍼 클래스의 기능을 확장***할 때 사용하는 가장 대표적인 방법이다.
* ***슈퍼 클래스에서 큰 틀을 만들고, 하위 클래스에서 세부 사항을 변경하도록 강제시켜 사용하는 패턴***

:point_right: 코드로 보는 템플릿 메서드 패턴

```java
public abstract class Super {
  public void templateMethod(){
    // 기본 알고리즘 코드
    hookMethod();
    abstractMethod();
    ...
  }
  protected void hookMethod(){} // 선택적으로 오버라이드 가능한 훅 메서드
  public abstract void abstractMethod(); // 서브클래스에서 반드시 구현해야 하는 추상 메서드
}

public class Sub1 extends Super {
  protected void hookMethod(){ // 선택적 오버라이딩
    ...
  } 
  public void abstractMethod() { // 반드시 구현
    ...
  }
}
```





## 팩토리 메서드 패턴

🤔 팩토리 메서드란?

* 서브클래스에서 오브젝트 생성 방법과 클래스를 결정할 수 있도록 미리 정의해둔 메서드를 팩토리 메서드라고 한다.
* **주로 인터페이스 타입으로 리턴을 한다.** 
* **자바에서는 종종 객체를 생성하는 기능을 가진 메서드를 일반적으로 팩토리 메서드라고 부른다고 한다.**

<img src="./image/image-20200830022752375.png" width="550" />

🤔 팩토리 메서드 패턴이란?

* ***서브클래스에서 구체적인 객체(Connection) 생성 방법을 결정하게 하는 것***

* 팩토리 메서드 패턴도 템플릿 메서드 패턴과 동일하게 ***상속을 통해 기능을 확장***하는 패턴이다.

* ***슈퍼클래스는 서브클래스에서 구현할 메서드를 호출해서 필요한 타입의 객체를 가져와 사용한다.***

  

