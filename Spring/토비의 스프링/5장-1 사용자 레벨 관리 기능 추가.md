# ëª©ì°¨

<br>

- [ëª©ì°¨](#ëª©ì°¨)
- [1 ì‚¬ìš©ì ë ˆë²¨ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€](#1-ì‚¬ìš©ì-ë ˆë²¨-ê´€ë¦¬-ê¸°ëŠ¥-ì¶”ê°€)
  - [1-1 í•„ë“œ ì¶”ê°€](#1-1-í•„ë“œ-ì¶”ê°€)
  - [1-2 ì‚¬ìš©ì ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€](#1-2-ì‚¬ìš©ì-ìˆ˜ì •-ê¸°ëŠ¥-ì¶”ê°€)
  - [1-3 ì„œë¹„ìŠ¤ ë¡œì§ êµ¬í˜„ - upgradeLevels](#1-3-ì„œë¹„ìŠ¤-ë¡œì§-êµ¬í˜„---upgradelevels)
  - [1-4 ì„œë¹„ìŠ¤ ë¡œì§ êµ¬í˜„ - add](#1-4-ì„œë¹„ìŠ¤-ë¡œì§-êµ¬í˜„---add)
  - [1-5 ì½”ë“œ ê°œì„ í•˜ê¸° (ë¦¬íŒ©í† ë§)](#1-5-ì½”ë“œ-ê°œì„ í•˜ê¸°-ë¦¬íŒ©í† ë§)

<br>

# 1 ì‚¬ìš©ì ë ˆë²¨ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€

ğŸ™‹â€â™‚ï¸ ì§€ê¸ˆê¹Œì§€ ê³„ì†í•´ì„œ `DAO` ë¡œì§ë§Œì„ ë§Œë“¤ì—ˆë‹¤. ì´ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë§Œë“¤ì–´ë³´ì.

ì•„ë˜ì™€ ê°™ì€ ê¸°ëŠ¥ì„ ê°€ì§„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë§Œë“¤ê³ ì í•œë‹¤.

* ì‚¬ìš©ì ë ˆë²¨ì€ BASIC, SILVER, GOLD
  * ì²˜ìŒ ê°€ì…í•˜ë©´ BASIC, í™œë™ì— ë”°ë¼ ë ˆë²¨ì—… (ê°€ì… í›„ 50íšŒ ì´ìƒ ë¡œê·¸ì¸ í•˜ë©´ SILVER, SILVERë©´ì„œ 30ë²ˆ ì´ìƒ ì¶”ì²œì„ ë°›ìœ¼ë©´ GOLD)
* ì‚¬ìš©ì ë ˆë²¨ì˜ ë³€ê²½ ì‘ì—…ì€ ì¼ì •í•œ ì£¼ê¸°ë¥¼ ê°€ì§€ê³  ì¼ê´„ì ìœ¼ë¡œ ì§„í–‰ëœë‹¤.
  * ë³€ê²½ ì‘ì—… ì „ì—ëŠ” ì¡°ê±´ì„ ì¶©ì¡±í•˜ë”ë¼ë„ ë ˆë²¨ì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

<br>

ğŸ™‹â€â™‚ï¸ **ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ëŠ” ì‘ì—…ì€ ì•„ë˜ì™€ ê°™ë‹¤.**
* í•„ë“œ ì¶”ê°€
  * `Level` í•„ë“œ ì¶”ê°€
  * `User` í•„ë“œ ì¶”ê°€ (ë¡œê·¸ì¸ íšŸìˆ˜, ì¶”ì²œìˆ˜, ë ˆë²¨)
  * `UserDao` í…ŒìŠ¤íŠ¸ ìˆ˜ì •
  * `UserDaoJdbc` ìˆ˜ì •
* ì‚¬ìš©ì ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€
* ì„œë¹„ìŠ¤ ë¡œì§ êµ¬í˜„ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

<br>

## 1-1 í•„ë“œ ì¶”ê°€

<br>

**1. Level í•„ë“œ ì¶”ê°€**

ğŸ™‹â€â™‚ï¸ ì‚¬ìš©ìë§ˆë‹¤ `Level` ì´ë¼ëŠ” í•„ë“œë¥¼ ì¶”ê°€í•´ì£¼ì.

* DBì— ë¬¸ìì—´(`BASIC`)ì„ ì €ì¥í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ” ì •ìˆ˜ì¸ 1, 2, 3ì„ ì €ì¥í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
  * DBì— ì €ì¥í•  ë•ŒëŠ” ìˆ«ìë¡œ ë³€ê²½í•´ì„œ ì €ì¥í•˜ê³ 
  * DBì—ì„œ ì¡°íšŒí•  ë•ŒëŠ” `enum` ê°’ìœ¼ë¡œ ë³€ê²½í•´ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```java
public enum Lever {
  BASIC(1), SILVER(2), GOLD(3);
  
  private final int value;
  
  // DBì— ì €ì¥í•  ê°’ì„ ë„£ì–´ì¤„ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ë‘”ë‹¤.
  Level(int value){
    this.value = value;
  }
  
  // ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œ
  public int intValue(){
    return value;
  }
  
  // DBì—ì„œ ìˆ«ì ê°’ì„ ë°›ì•„ì™€ì„œ ê°’ìœ¼ë¡œë¶€í„° Levelíƒ€ì… ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë§Œë“  ìŠ¤íƒœí‹± ë©”ì„œë“œ.
  public static Level valueOf(int value){
    switch(value){
      case 1: return BASIC;
      case 2: return SILVER;
      case 3: return GOLD;
      default: throw new AssertionError("Unknown value: " + value);
    }
  }
}
```

ğŸ¤” `enum`ì„ ì‚¬ìš©í•œ ì´ìœ ëŠ”?

* ì •ìˆ˜í˜• ìƒìˆ˜ ê°’(`private static final int BASIC = 1`)ì„ ì‚¬ìš©í•˜ë©´ ì—‰ëš±í•œ ê°’ì„ ë„£ì—ˆì„ ë•Œ ì»´íŒŒì¼ëŸ¬ê°€ ì²´í¬í•´ì£¼ì§€ ëª»í•œë‹¤. 
  * `user.setLevel(1000)` ì„ í•´ë„ ì»´íŒŒì¼ëŸ¬ê°€ ì¡ì•„ë‚´ì§€ ëª»í•œë‹¤.
* `enum` ì€ ì •ìˆ˜ ê°’ì„ ê°€ì§€ê³  ìˆì§€ë§Œ, ê²‰ìœ¼ë¡œëŠ” `Level` íƒ€ì…ì˜ ê°ì²´ê¸° ë•Œë¬¸ì— ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  * **ìƒíƒœê°€ ì•„ë‹Œ í•˜ë‚˜ì˜ ììœ¨ì ì¸ ê°ì²´ê°€ ë  ìˆ˜ ìˆëŠ” ê¸°íšŒ.**

<br>

**2. Userí•„ë“œ ì¶”ê°€**

ğŸ™‹â€â™‚ï¸ ë ˆë²¨ì„ ë§Œë“¤ì—ˆìœ¼ë‹ˆ, DBì™€ `User` ê°ì²´ì˜ ìƒíƒœë¥¼ ë³€ê²½í•´ì¤˜ì•¼ í•œë‹¤.

```java
public class User {
  ...
  Level level; 
  int login; // ë¡œê·¸ì¸ íšŸìˆ˜
  int recommend; // ì¶”ì²œìˆ˜
  
  // getter / setter
}
```

* `User` ë¿ë§Œ ì•„ë‹ˆë¼ DBë„ 3ê°€ì§€ì˜ ìƒíƒœë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.
  * Level/tinyint/NotNull
  * Login/int/NotNull
  * Recommend/int/NotNull

<br>

**3. UserDaoTest ìˆ˜ì •**
* `User` ìƒì„±ì‹œ ìƒˆë¡œ ìƒê¸´ 3ê°€ì§€ ìƒíƒœë¥¼ ì¶”ê°€ ì¸ìë¡œ ë„£ì–´ì¤¬ë‹¤. [ì½”ë“œ]()
> **ì¤‘ìš”í•œ ê²ƒì€ DBì— ì €ì¥í•  ë•ŒëŠ” `intValue()` ë¥¼ í†µí•´ `Level` ì„ ìˆ«ìë¡œ ì €ì¥í•œë‹¤ëŠ” ê²ƒì´ë‹¤.**

<br>

**4. UserDaoJdbc ìˆ˜ì •**

ë³€ê²½ëœ ì½”ë“œëŠ” [UserDaoJdbc]() ì—ì„œ í™•ì¸ ê°€ëŠ¥í•˜ë©°, ë³€ê²½ëœ ë‚´ìš©ì€ ì•„ë˜ì™€ ê°™ë‹¤.

* `RowMapper` ì—ì„œ ìƒˆë¡œ ìƒê¸´ 3ê°€ì§€ ìƒíƒœë„ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

  * ```java
    user.setLevel(Level.valueOf(resultSet.getInt("level")));
    user.setLogin(resultSet.getInt("login"));
    user.setRecommend(resultSet.getInt("recommend"));
    ```

  * **ì¤‘ìš”í•œ ê²ƒì€ DBì—ì„œ ê°€ì ¸ì˜¨ ì •ìˆ˜í˜• ë ˆë²¨ì„ `Level` ì´ë¼ëŠ” `enum` ê°ì²´ë¡œ ë³€ê²½í•œë‹¤ëŠ” ê²ƒì´ë‹¤.**

<br>

## 1-2 ì‚¬ìš©ì ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€

ğŸ™‹â€â™‚ï¸ **ìˆ˜ì •í•  ì •ë³´ê°€ ë‹´ê¸´ `User` ê°ì²´ë¥¼ ì „ë‹¬í•˜ë©´ `id` ë¥¼ ì°¸ê³ í•´ì„œ ì—…ë°ì´íŠ¸í•´ì£¼ëŠ” ë¡œì§ì„ ë§Œë“¤ì–´ì£¼ì.**

<br>

**1. ìˆ˜ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì¶”ê°€**

```java
@Test
void update(){
    userDao.deleteAll();

    userDao.add(user1);

    user1.setName("ë³€ê²½ ì•„ì´ë””");
    user1.setPassword("test1234");
    user1.setLevel(Level.GOLD);
    user1.setLogin(1000);
    user1.setRecommend(999);

    userDao.update(user1);

    User user1update = userDao.get(user1.getId());
    checkSameUser(user1, user1update);
}
```

* `user1` ì˜ ìƒíƒœë¥¼ ìˆ˜ì •í•˜ê³  DBì— ì—…ë°ì´íŠ¸í•˜ê³ ë‚˜ì„œ ì¡°íšŒí•œ í›„ì— ë™ì¼í•œ ê°’ì„ ê°€ì§„ ê°ì²´ì¸ì§€ í™•ì¸í•œë‹¤.

<br>

**2. UserDaoì™€ UserDaoJdbc ìˆ˜ì •**

ğŸ™‹â€â™‚ï¸ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ë¨¼ì € ì‘ì„±í•˜ê³  ë¡œì§ì„ ìˆ˜ì •í•˜ì˜€ë‹¤. (ë°°ì›Œì•¼ í•  ì )

* í…ŒìŠ¤íŠ¸ì½”ë“œì—ì„œ `update` ë©”ì„œë“œê°€ ìƒˆë¡œ ìƒê²¼ìœ¼ë‹ˆ ì´ê²ƒì„ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.

```java
public void update(User user) {
    this.jdbcTemplate.update(
            "update users set name = ?, password = ? , level = ?, login = ?, recommend = ? where id = ?",
            user.getName(), user.getPassword(), user.getLevel().intValue(), user.getLogin(), user.getRecommend(), user.getId());
}
```

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ëŒë¦¬ë©´ ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

<br>

## 1-3 ì„œë¹„ìŠ¤ ë¡œì§ êµ¬í˜„ - upgradeLevels

ğŸ™‹â€â™‚ï¸ `DAO` ë¡œì§ê³¼ ì„œë¹„ìŠ¤ ë¡œì§ì˜ ì°¨ì´

* `DAO` : ë°ì´í„° ì•¡ì„¸ìŠ¤ ë¡œì§ (Persistence Layer)
  * ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ê°€ì ¸ì˜¤ê³  ì¡°ì‘í• ì§€ë¥¼ ë‹¤ë£¨ëŠ” ê³„ì¸µ
* ì„œë¹„ìŠ¤ ë¡œì§ : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Service Layer)ì„ ê´€ì¥
  * êµ¬ì²´ì ìœ¼ë¡œ ë§í•˜ë©´ ë„ë©”ì¸ì´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒ!

<br>

**1. upgradeLevels êµ¬í˜„**

ğŸ™‹â€â™‚ï¸ ì£¼ê¸°ì ìœ¼ë¡œ ìœ ì €ë“¤ì˜ ë ˆë²¨ì„ ì²´í¬í•˜ê³  ì—…ê·¸ë ˆì´ë“œ ì‹œì¼œì£¼ëŠ” ë¡œì§

```java
public class UserService {
  
	  private static final int MIN_LOGCOUNT_FOR_SILVER = 50;
    private static final int MIN_RECCOMEND_FOR_GOLD = 30;

    private UserDao userDao;

    @Autowired
    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }
    
    public void upgradeLevels(){
        List<User> users = userDao.getAll();
        for(User user : users){
            boolean changed = false;
            if(user.getLevel() == Level.BASIC && user.getLogin() >= UserService.MIN...){
                user.setLevel(Level.SILVER);
                changed = true;
            } else if(user.getLevel() == Level.SILVER && user.getRecommend() >= US.MIN...){
                user.setLevel(Level.GOLD);
                changed = true;
            }
            if(changed){
                userDao.update(user);
            }
        }
    }
}
```

* `upgradeLevels` ëŠ” ê° íšŒì›ë“¤ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ì—¬ ë ˆë²¨ì„ ì¡°ì ˆí•œë‹¤.
  * **ë¬¸ì œëŠ” ì½”ë“œê°€ ë§¤ìš° ë‚œì¡í•˜ë‹¤ëŠ” ê²ƒ. ì¶”í›„ì— ë¦¬íŒ©í† ë§ì„ í•œë‹¤.**

<br>

**2. upgradeLevels í…ŒìŠ¤íŠ¸**

```java
@ExtendWith(SpringExtension.class)
@SpringJUnitConfig(Config.class)
class UserServiceTest {

    List<User> users;

    @BeforeEach
    void setUp(){
        users = Arrays.asList(
                new User("binghe", "ê¹€ë³‘í™”", "test1", Level.BASIC, 49, 0),
                new User("honggildong", "í™ê¸¸ë™", "test2", Level.BASIC, 50, 0),
                new User("springtoby", "í† ë¹„ë‹˜", "test3", Level.SILVER, 60, 29),
                new User("java", "ìë°”", "java1234", Level.SILVER, 60, 30),
                new User("service", "ì„œë¹„ìŠ¤", "service", Level.GOLD, 100, 100)
        );
    }

    @DisplayName("ë ˆë²¨ ì²´í¬ í…ŒìŠ¤íŠ¸")
    @Test
    void upgradeLevels(){
        userDao.deleteAll();
        for(User user : users)
            userDao.add(user);

        userService.upgradeLevels();

        checkLevel(users.get(0), Level.BASIC);
        checkLevel(users.get(1), Level.SILVER);
        checkLevel(users.get(2), Level.SILVER);
        checkLevel(users.get(3), Level.GOLD);
        checkLevel(users.get(4), Level.GOLD);
    }

    private void checkLevel(User user, Level expectedLevel){
        User userUpdate = userDao.get(user.getId());
        assertEquals(expectedLevel, userUpdate.getLevel());
    }

}
```

* ë‹¤ì„¯ëª…ì˜ ìœ ì €ë¥¼ ì €ì¥í•˜ê³ , ë ˆë²¨ì´ ì—…ê·¸ë ˆì´ë“œ ë˜ëŠ”ì§€ ì²´í¬í•˜ëŠ” ì½”ë“œ.

<br>

## 1-4 ì„œë¹„ìŠ¤ ë¡œì§ êµ¬í˜„ - add

ğŸ™‹â€â™‚ï¸ íšŒì›ê°€ì… ì„œë¹„ìŠ¤ ë¡œì§ì„ êµ¬í˜„í•´ë³´ì.
* ì²˜ìŒ ê°€ì…í•˜ë©´ ë ˆë²¨ì€ `BASIC` ì´ì—¬ì•¼ í•œë‹¤.

<br>

**1.add í…ŒìŠ¤íŠ¸**

```java
@Test
void add(){
    userDao.deleteAll();

    User userWithLevel = users.get(4); // GOLD ë ˆë²¨ì¸ ìœ ì €ì´ë¯€ë¡œ ë ˆë²¨ì„ ì´ˆê¸°í™”í•˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.
    User userWithoutLevel = users.get(0);
    userWithoutLevel.setLevel(null); // ë ˆë²¨ì´ ë¹„ì–´ ìˆìœ¼ë¯€ë¡œ ë¡œì§ì— ë”°ë¼ ë“±ë¡ ì¤‘ BASICë ˆë²¨ë¡œ ì„¤ì •ë˜ì•¼í•œë‹¤.

    userService.add(userWithLevel);
    userService.add(userWithoutLevel);

    User userWithLevelRead = userDao.get(userWithLevel.getId());
    User userWithoutLevelRead = userDao.get(userWithoutLevel.getId());

    assertEquals(userWithLevel.getLevel(), userWithLevelRead.getLevel());
    assertEquals(userWithoutLevel.getLevel(), userWithoutLevelRead.getLevel());
}
```
* ë ˆë²¨ì´ ì´ë¯¸ ì •í•´ì§„ ìœ ì €ì™€ ë ˆë²¨ì´ ì •í•´ì§€ì§€ ì•Šì€ ìœ ì €ë¥¼ ìƒì„±í•˜ì—¬ ë ˆë²¨ì´ ì—†ëŠ” ê²½ìš° ì´ˆê¸°í™”ë¥¼ í•˜ëŠ” ë¡œì§ì„ í…ŒìŠ¤íŠ¸í•œë‹¤.

<br>

**2.addë¡œì§**

```java
public void add(User user) {
    if(user.getLevel() == null){
        user.setLevel(Level.BASIC);
    }
    userDao.add(user);
}
```

<br>

## 1-5 ì½”ë“œ ê°œì„ í•˜ê¸° (ë¦¬íŒ©í† ë§)
ğŸ™‹â€â™‚ï¸ ì½”ë“œë¥¼ ë¦¬íŒ©í† ë§í•´ë³´ì. ë¦¬íŒ©í† ë§ ë‚´ìš©
* ì½”ë“œì— ì¤‘ë³µëœ ë¶€ë¶„ì€ ì—†ëŠ”ê°€?
* ì½”ë“œê°€ ë¬´ì—‡ì„ í•˜ëŠ” ê²ƒì¸ì§€ ì´í•´í•˜ê¸° ë¶ˆí¸í•˜ì§€ ì•ŠëŠ”ê°€?
* ì½”ë“œê°€ ìì‹ ì´ ìˆì–´ì•¼ í•  ìë¦¬ì— ìˆëŠ”ê°€?
* ì•ìœ¼ë¡œ ë³€ê²½ì´ ì¼ì–´ë‚œë‹¤ë©´ ì–´ë–¤ ê²ƒì´ ìˆì„ ìˆ˜ ìˆê³ , ê·¸ ë³€í™”ì— ì‰½ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆê»˜ ì‘ì„±ë˜ì–´ ìˆëŠ”ê°€?

<br>

**1.upgradeLevels ì½”ë“œ ë¶„ë¦¬**

:scream: ê¸°ì¡´ `UserSerivce.upgradeLevels` ì˜ ë¬¸ì œ
* ë ˆë²¨ ê°œìˆ˜ë§Œí¼ ifë¬¸ì´ ë°˜ë³µëœë‹¤. ë§Œì•½ ìƒˆë¡œìš´ ë ˆë²¨ì´ ì¶”ê°€ëœë‹¤ë©´ `Level` ì´ëŠ„ë„ ìˆ˜ì •í•´ì•¼ í•˜ê³ , `upgradeLevels` ì˜ ë¡œì§ë„ ë³€ê²½ì´ í•„ìš”í•˜ë‹¤.
* ì´í•´í•˜ê¸° í˜ë“¤ë‹¤.

<br>

ğŸ¤” í•´ê²°ë°©ë²•ì€?

* ëª¨ë“  ê°ì²´ë¥¼ ììœ¨ì ì¸ ê°ì²´ë¡œ ë§Œë“¤ì–´ì£¼ë©´ ëœë‹¤. -> ì½”ë“œë¥¼ ë¶„ë¦¬í•´ë³´ì.

**1ì°¨ ë¦¬íŒ©í† ë§ - ë©”ì„œë“œ ì¶”ì¶œ**

```java
public void upgradeLevels(){
    List<User> users = userDao.getAll();
    for(User user : users){
        if(canUpgradeLevel(user)){
            upgradeLevel(user);
        }
    }
}

private boolean canUpgradeLevel(User user) {
    Level currentLevel = user.getLevel();
    switch (currentLevel){
        case BASIC: return (user.getLogin() >= 50);
        case SILVER: return (user.getRecommend() >= 30);
        case GOLD: return false;
        // í˜„ì¬ ë¡œì§ì´ ë‹¤ë£° ìˆ˜ ì—†ëŠ” ë ˆë²¨ì¸ ê²½ìš° ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤.
        default: throw new IllegalArgumentException("Unknown Level : "+currentLevel);
    }
}

private void upgradeLevel(User user) {
    if(user.getLevel() == Level.BASIC) user.setLevel(Level.SILVER);
    else if(user.getLevel() == Level.SILVER) user.setLevel(Level.GOLD);
    userDao.update(user);
}
```

`upgradeLevels` ì˜ ë¡œì§ì´ ë§¤ìš° ê°„ë‹¨í•´ì¡Œë‹¤.

* ëª¨ë“  ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ í•œ ëª…ì”© ì—…ê·¸ë ˆì´ë“œê°€ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ê³  (`if(canUpgradeLevel(users))`)
* ê°€ëŠ¥í•˜ë©´ ì—…ê·¸ë ˆì´ë“œë¥¼ í•œë‹¤. (`upgradeLevel(user)`)

> **ë˜í•œ í˜„ì¬ ë¡œì§ì´ ë‹¤ë£° ìˆ˜ ì—†ëŠ” ë ˆë²¨(ì˜ˆì™¸)ì¸ ê²½ìš°ëŠ” ê¼­ ì˜ˆì™¸ë¥¼ í†µí•´ ê°œë°œìê°€ ì–´ë–¤ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆê²Œ í•´ì•¼í•œë‹¤.**

<br>

**2ì°¨ ë¦¬íŒ©í† ë§ - ë©”ì‹œì§€ë¡œ ìœ„ì„**

> ë°ì´í„°(`Level`)ë§Œ ê°€ì ¸ì™€ì„œ í”„ë¡œì„¸ìŠ¤(`UserService`)ì—ì„œ ë‹¤ìŒ ë‹¨ê³„ ë ˆë²¨ì„ ì²˜ë¦¬í•˜ëŠ” ê²ƒì€ **ì ˆì°¨ì§€í–¥ì ** ì½”ë“œì´ë‹¤.
>
> **ê°ì²´ì§€í–¥ì **ì½”ë“œëŠ” ë°ì´í„°ì™€ í”„ë¡œì„¸ìŠ¤ë¥¼ ëª¨ë‘ ê°ì²´ ìì‹ ì´ ê°€ì§€ê³  ìˆëŠ”ë‹¤. (ììœ¨ì ì¸ ê°ì²´)

[1ì°¨ ë¦¬íŒ©í† ë§](#1ì°¨-ë¦¬íŒ©í† ë§)ì—ì„œ ì½”ë“œë¥¼ ê°„ë‹¨íˆ ë¶„ë¦¬í–ˆì§€ë§Œ, **ì—¬ì „íˆ ìƒˆë¡œìš´ ë ˆë²¨ì„ ì¶”ê°€í•˜ë©´ ë§ì€ ë¡œì§ë“¤ì„ ë³€ê²½í•´ì¤˜ì•¼í•œë‹¤. (ë³€ê²½ì— ì·¨ì•½í•˜ë‹¤.)**

**ê° ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ê³ , ë©”ì‹œì§€ë¥¼ í†µí•œ ìš”ì²­ìœ¼ë¡œ ë¡œì§ì„ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½í•´ì•¼í•œë‹¤.**

* `Level` ì—ì„œ ë‹¤ìŒ ë‹¨ê³„ì˜ ë ˆë²¨ ì •ë³´ë¥¼ ì§ì ‘ ê°€ì§€ê³  ìˆê²Œí•œë‹¤.
* ì‚¬ìš©ì ì •ë³´ë¥¼ ë°”ê¾¸ëŠ” ë¡œì§ì„ `UserService` ê°€ ì•„ë‹Œ `User` ê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•œë‹¤. (ììœ¨ì ì¸ ê°ì²´)
  * `User` ì˜ ìƒíƒœë¥¼ ë°”ê¾¸ëŠ” í–‰ìœ„(ë ˆë²¨ì˜ ì—…ê·¸ë ˆì´ë“œ)ì´ë¯€ë¡œ `User` ìì‹ ì´ ì²˜ë¦¬í•˜ê³ , `UserService` ëŠ” ë©”ì‹œì§€ë¥¼ í†µí•´ ìš”ì²­í•˜ëŠ” ë°©ì‹.

```java
public enum Level {
	  // DBì— ì €ì¥í•  ê°’ê³¼ í•¨ê»˜ ë‹¤ìŒ ë‹¨ê³„ì˜ ë ˆë²¨ ì •ë³´ë„ ì¶”ê°€í•œë‹¤.
    GOLD(3, null), SILVER(2, GOLD), BASIC(1, SILVER);

    private final int value;
    private final Level next;

    // DBì— ì €ì¥í•  ê°’ì„ ë„£ì–´ì¤„ ìƒì„±ìë¥¼ ë§Œë“¤ì–´ë‘”ë‹¤
    Level(int value, Level next){
        this.value = value;
        this.next = next;
    }

    // ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œ
    public int intValue(){
        return value;
    }
    
    public Level nextLevel() { return this.nextLevel(); }

    public static Level valueOf(int value){
        switch (value){
            case 1: return BASIC;
            case 2: return SILVER;
            case 3: return GOLD;
            default: throw new AssertionError("Unknown value: " + value);
        }
    }
}
```

```java
public class User {
  ...
    
  public void upgradeLevel(){
    Level nextLevel = this.level.nextLevel();
    if(nextLevel == null)
      throw new IllegalStateException(this.level + "ì€ ì—…ê·¸ë ˆì´ë“œê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
    else
      this.level = nextLevel;
  }
  
  ...
}
```

```java
public class UserService {
  ...
  
  private void upgradeLevel(User user){
    user.upgradeLevel(); // ë ˆë²¨ì„ ì—…ê·¸ë ˆì´ë“œí•´ë‹¬ë¼ê³  Userì—ê²Œ ìš”ì²­.
    userDao.update(user);
  }
  
  ...
}
```

<br>

**2.User í…ŒìŠ¤íŠ¸**

`User` ì˜ ì½”ë“œê°€ ì¶”ê°€ë˜ì—ˆìœ¼ë¯€ë¡œ `User` ì˜ í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤. 

ì§€ê¸ˆì€ í•„ìš” ì—†ì–´ë³´ì´ì§€ë§Œ, ì‹œìŠ¤í…œì´ ì»¤ì ¸ì„œ ì–´ë–¤ ë¬¸ì œê°€ ë°œìƒí• ì§€ ëª¨ë¥´ê¸°ë•Œë¬¸ì— í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

[ì½”ë“œ]()

> `User` ëŠ” POJOì´ê¸°ì— `Extension` ì—†ì´ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.

<br>

**3.UserService í…ŒìŠ¤íŠ¸**

ë¦¬íŒ©í† ë§ì„ í†µí•´ ë§ì€ ì½”ë“œë¥¼ ë³€ê²½í–ˆìœ¼ë¯€ë¡œ, ë³€ê²½ì— ë§ì¶° `UserService` ì˜ í…ŒìŠ¤íŠ¸ë„ ë³€ê²½í•´ì¤˜ì•¼í•œë‹¤.

( ê°€ì¥ ì¢‹ì€ ê±´ í…ŒìŠ¤íŠ¸ë¥¼ ë¨¼ì € ì™„ì„±ì‹œí‚¤ê³ , ì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒ ê°™ë‹¤... ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  í…ŒìŠ¤íŠ¸ ì‘ì„±í•˜ë ¤ë‹ˆ ê·€ì°®ë‹¤..)

<br>

**4. ì—…ê·¸ë ˆì´ë“œ ì •ì±… ë¶„ë¦¬**

ë§Œì•½ ì—°ë§ ì´ë²¤íŠ¸ë‚˜ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ í™ë³´ê¸°ê°„ ì¤‘ì—ëŠ” ë ˆë²¨ ì—…ê·¸ë ˆì´ë“œ ì •ì±…ì´ ë³€ê²½í•´ì•¼í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.

ì´ëŸ´ ê²½ìš°, ë§¤ë²ˆ `UserService` ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì€ ë²ˆê±°ëŸ½ê³  ìœ„í—˜í•œ ë°©ë²•ì´ë‹¤.

ì´ëŸ´ ë• ì‚¬ìš©ì ì—…ê·¸ë ˆì´ë“œ ì •ì±…ì„ ë”°ë¡œ ë¶„ë¦¬í•˜ì.

```java
public interface UserLevelUpgradePolicy {
  boolean canUpgradeLevel(User user);
  void upgradeLevel(User user);
}
```