# 목차

<br>

- [목차](#목차)
- [컴퓨터 네트워크 기본](#컴퓨터-네트워크-기본)
- [1 네트워크 구성요소](#1-네트워크-구성요소)
- [2 데이터 전송 방법](#2-데이터-전송-방법)
  - [2-1 TCP vs UDP](#2-1-tcp-vs-udp)
  - [2-2 Protocol](#2-2-protocol)
  - [2-2 Packet Switching vs Circuit Switching](#2-2-packet-switching-vs-circuit-switching)
  - [2-3 네트워크 데이터 전송이 늦어지는 이유](#2-3-네트워크-데이터-전송이-늦어지는-이유)
  - [2-4 패킷 유실](#2-4-패킷-유실)
- [생각해볼 점](#생각해볼-점)
- [참고](#참고)

<br>

# 컴퓨터 네트워크 기본
이번 장의 목표 -> 네트워크에 대한 전체적인 큰 그림 그리기.


<br>

# 1 네트워크 구성요소
이번 장의 목표는 네트워크의 큰 그림을 그리는 것이다.

그러기에.. 첫 부분은 네트워크의 구성요소에 대해서 다룬다.

<br>

💁‍♂️ **네트워크 구성요소**

<p align="center"><img src="./image/network_overview.png"> </p>

위 그림에서 볼 수 있듯이, 네트워크는 굉장히 많은 Node들의 연결로 되어있다.

크게 세 가지의 요소로 구성된다.

* network edge
  * applications and hosts
  * 애플리케이션과 호스트 (위 그림에서 가장자리)
* network core
  * routers, network of networks
  * 네트워크들간의 통신을 위한 라우터 (위 그림에서 중앙부분)
* access networks, physical media
  * communication links
  * 각 네트워크 장비를 이어주는 연결 요소 (ex. 케이블, 이더넷, 와이파이, LTE, 구리선등등)

<br>

💁‍♂️ **보통 End System (Hosts)끼리 통신한다.**

보통 네트워크를 이용하여 End System (위 그림에선 가장자리)끼리 통신한다.

> End System (Hosts): run application programs (ex. Web, email)

통신 형식은 `Client - Server 모델`과 `Peer - Peer 모델`이 존재한다.

<br>

# 2 데이터 전송 방법
네트워크에 대한 구성요소를 통해 큰그림을 그렸다면, 이제 End Point들끼리 어떻게 데이터를 전송하는지에 대해서 다룬다.

> 전송 계층의 내용이기도 하다.

<br>

## 2-1 TCP vs UDP
💁‍♂️ 시스템간의 데이터를 전송하는 방법은 두 가지로 나뉜다.

* TCP
  * 데이터를 주고받기 전에, 미리 통로를 연결한 다음에 데이터를 주고 받는 방식.
  * 장점
    * 신뢰성 - 순서를 지키면서 통신되며, 신뢰성이 있다.
    * Flow Control - Sender가 Receiver의 처리 속도에 맞춰서 데이터를 전송한다.
    * Congestion Control - Sender가 Receiver 중간의 네트워크 처리 가능량에 따라 데이터를 주고 받는다.
  * 단점
    * 데이터를 주고 받기 전후로 핸드셰이크를해야하기에 비용이 비교적 크다.
* UDP
  * Sender가 그저 데이터를 바로바로 보내는 방식
  * 장점
    * 빠르다.
  * 단점
    * 신뢰성이 떨어진다, Flow Control, Congestion Control 모두 사용 불가.

> 이번 장은 간단하게 큰 그림을 그려보는 부분이기에 간단히만 정리한다.
> 
> 자세한 내용은 전송 계층에서 다룰 예정이다.

<br>

## 2-2 Protocol
TCP, UDP에서의 P는 Protocol을 의미하며, 이는 네트워크에서 흔히 사용되는 굉장히 빈번하게 사용되는 용어이다.

<br>

🤔 **Protocol**
* All communication in Internet coordinated by protocols
  * 서로 간의 통신을 위한 약속한 규격을 의미한다.
  * ex. 언어, 대화의 약속
* 재밌는 예시: `난 쟤랑 프로토콜이 안 맞아`

<br>

## 2-2 Packet Switching vs Circuit Switching
이제 네트워크의 Core 부분에 속하는 내용을 이야기해본다.

네트워크의 목적은 End Point들끼리의 통신이라고 말했다.

그리고 **네트워크의 중간부분인 라우터 (Network Core)이 데이터를 전달하는 역할을 맡는다.**

<br>

🤔 **그렇다면 각 라우터들은 어떤 방식으로 데이터를 전송하고 받는 것일까?**

1. circuit-switching
2. packet-switching

<br>

💁‍♂️ **circuit-switching**

<p align="center"><img src="./image/circuit_switching.png">출처: http://www.kocw.or.kr/home/cview.do?mty=p&kemId=1169634  </p>

* 개념
  * 출발지부터 목적지까지의 길을 미리 만들어두고 데이터를 주고 받는 방식이다.
    * 즉, 하나의 회선을 할당받아 데이터를 주고받는 방식.
  * 먼저 통신을 위한 연결을 해야하며, 연결이되고나면 출발지로부터 목적지까지 도착하는데 사용되는 회선 전체를 독점 (dedicated)하기 때문에 다른 사람이 끼어들 수 없다.
* 보통은 전화와 같은 실시간 통신에 사용된다.

<br>

💁‍♂️ **packet-switching**

<p align="center"><img src="./image/packet_switching.png"><br>출처: http://www.kocw.or.kr/home/cview.do?mty=p&kemId=1169634 </p>

* 개념
  * 데이터를 packet 단위로 쪼개서 전송하는 방식을 의미한다. (packet 단위로 청크 처리)
  * 미리 전송 경로를 정하지않고, 통계적 다중화 방식으로 패킷을 전송한다.
* 현재 대부분의 HTTP에서 사용중인 데이터 전송 방식이다.

<br>

💁‍♂️ **두 전송방식의 비교**

<p align="center"><img src="./image/"> </p>

**라우터가 1 Mb/s의 대역폭과 처리속도를 지니며, 각 유저당 100kb/s씩 할당해준다고 가정해본다.**

* circuit-switching
  * **서킷은 10명만 사용이 가능하다.** (회선을 독점하기 때문이다.)
* packet-switching
  * **회선을 독점하지않고 사용할 때만 잠시 회선을 이용하고 끊기때문에 많은 유저가 사용할 수 있다.**
  * 단, **정확히 10명이 동시에 요청한다면 라우터는 Queue에 요청을 쌓아서 처리한다.**

> 현재 인터넷은 HTTP와 TCP의 특성상 Packet Switching을 이용한다.
> 
> **HTTP는 TCP를 이용하여 원하는 데이터만을 주고받고 연결을 끊기 때문에, 굳이 회선을 계속해서 차지할 필요가없어 회선을 공유하는 packet-switching 방식을 채택한 것.**

<br>

## 2-3 네트워크 데이터 전송이 늦어지는 이유
앞서 말했듯이 인터넷은 TCP 기반의 packet-switching 방식을 이용한다.

이번엔 packet-switching 기준으로 라우터가 데이터를 어떻게 처리하고 전송하는지 살펴본다.

그리고 이 과정에서 왜 데이터 전송이 늦어지는지 알아본다.

**라우터가 다른 라우터로부터 데이터를 받고 다른 라우터로 전송하기까지 지연(Delay)되는 부분은 크게 4가지이다.**

1. Node processing
2. Queueing
3. Transmission delay
4. Propagation Delay

> 그리고 패킷이 유실도 하나의 데이터 전송이 늦어지는 이유중 하나이다.

<br>

💁‍♂️ **Node processing와 Queueing**

<p align="center"><img src="./image/packet_switching_delay_1.png"><br>출처: http://www.kocw.or.kr/home/cview.do?mty=p&kemId=1169634 </p>

* **node processing**
  * check bit errors (유효성 검사)
  * determine output link (목적지 체크)
* **Queueing**
  * time waiting at ouput link for transmission
    * **라우터가 처리가능 대역폭을 넘는 요청이 온다면 Queue를 이용하여 줄을 세워 차례대로 처리한다.** (버퍼 처리)
  * dependes on congestion level of router
    * **라우터의 혼잡 제어 수준에 따라 지연(Delay) 여부가 결정된다.**

<br>

💁‍♂️ **Transmission Delay와 Progagation Delay**

<p align="center"><img src="./image/packet_switching_delay_2.png"><br>출처: http://www.kocw.or.kr/home/cview.do?mty=p&kemId=1169634 </p>

* **Trasmission Delay**
  * 특정 Packet의 첫 비트부터 마지막 비트가 라우터를 빠져나가기까지의 Delay
  * time to send bits into link = 패킷 크기 / 대역폭
    * 대역폭이 클수록 이 지연은 짧아진다.
    * 비유: 통로가 좁은 깔때기에 양동이의 물(Packet)을 부으면 모두 통과하기까지 오래걸린다. 반면에, 통로가 넓은 깔때기에 동일한 양동이의 물을 부으면 한번에 통과할 수 있다.
* **Propagation Delay**
  * 패킷이 목적 라우터까지 도달하기까지의 시간.
  * propagation delay = link 길이 / 빛의 속도
     * 이 지연은 우리가 해결할 수 없다. (물리적으로 해결해야하는 문제)

<br>

**💁‍♂️ 보통은 트래픽이 몰렸을 경우, Queing Delay가 많이 발생한다.**

<p align="center"><img src="./image/queueing_delay.png"> </p>

트래픽이 몰렸을 경우, 도저히 대역폭과 라우터가 바로바로 처리할 수 없기에 Queueing을 하는데...

**여기서 줄을 기다리는 패킷이 모두 지연(Delay)된다고 볼 수 있다.**

<br>

🤔 **지연(Delay)를 줄일 방법은 없을까?**

* Queueing Delay
  * 사람이 한번에 몰리면 자주 발생하는 Delay이다. (제일 골치 아픔)
  * **지연을 줄이는 방법은 대역폭을 늘리고 라우터의 처리 속도를 높이면 된다.**
    * **그럼에도 많은 양의 트래픽이 몰리면 지연이 발생한다.**
  * **비유: 톨게이트 - 차로를 넓히고, 하이패스를 도입하면 빠르게 차들을 보낼 수 있다.**
    * **그럼에도 추석땐 항상 막힌다.. 너무 많은 차량이 몰리기 때문..**
* Transmission Delay
  * 라우터와 케이블을 업그레이드함으로써 지연을 막을 수 있다.
  * 실제로 ISP들이 주기적으로 라우터와 케이블의 대규모 공사를하는 이유라고한다.
  
<br>

## 2-4 패킷 유실
packing-switching에서 당연히 패킷이 유실된다.

<br>

💁‍♂️ **90%의 패킷 유실는 Queueing 때문이라고 한다.**

라우터의 처리량과 대역폭보다 많은 사용자가 한번에 몰리면 라우터는 Queue를 통해 패킷을 줄 세워 처리하게된다.

이때 **라우터 Queue의 사이즈보다 큰 요청이오면, 당연히 패킷은 유실된다.**

실제로 이로인한 패킷 유실이 90%에 달한다고한다.

<br>

🤔 **TCP는 신뢰성있는 전송 방식인데.. 패킷이 유실될 경우 어떻게 처리하는가?**

**TCP는 신뢰성있는 통신을 위해 `재전송` 방식을 이용하여 패킷이 유실될 경우 해당 패킷을 재전송한다.**

<p align="center"><img src="./image/queueing_retry.png"> </p>

그리고 **Network Core인 라우터는 보통 데이터를 받고 그대로 전송만하는 bypass 역할을하기에, 재전송 로직은 End Point에 존재한다고한다.**

**TCP는 보통 timeout을 통해 패킷을 재전송한다고한다.** 이와 관련해서도 전송 계층에서 더 자세히 다룰 예정이다.

> 스터디중 한 분이 라우터의 발전에 따라 라우터가 재전송 로직을 가지는 경우도 있다고한다. (추후에 한번 더 자세히 알아볼 예정이다.)

<br>

# 생각해볼 점
> 스터디를 진행하며 나온 여러가지 여담에 대해서 정리한다.

* HTTP/3부터는 UDP를 이용한 통신을 지향한다.
  * 참고: https://blog.cloudflare.com/http3-the-past-present-and-future/

<br>

# 참고
* http://www.kocw.or.kr/home/cview.do?mty=p&kemId=1169634


