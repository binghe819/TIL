> 본 자료는 [Effective Java 3/E]()를 바탕으로 작성되었습니다.

# 아이템 15. 클래스와 멤버의 접근 권한을 최소화하라

- [아이템 15. 클래스와 멤버의 접근 권한을 최소화하라](#아이템-15-클래스와-멤버의-접근-권한을-최소화하라)
  - [정보 은닉](#정보-은닉)
    - [자율적인 객체](#자율적인-객체)
    - [정보 은닉의 장점](#정보-은닉의-장점)
  - [캡슐화 원칙](#캡슐화-원칙)
    - [접근 제어자](#접근-제어자)
    - [기본 원칙](#기본-원칙)
    - [공개 API의 제약](#공개-api의-제약)
  - [public 클래스의 인스턴스 필드는 되도록 public이 아니어야 한다.](#public-클래스의-인스턴스-필드는-되도록-public이-아니어야-한다)
  - [자바 9부터 도입된 모듈 시스템](#자바-9부터-도입된-모듈-시스템)
  - [요약](#요약)

<br>

## 정보 은닉

> 캡슐화 == 정보은닉

### 자율적인 객체

클래스는 2가지로 나눌 수 있다.

* 내부 정보 (구현)
* 외부 정보 (API)

**잘 설계된 컴포넌트는 모든 내부 구현을 완벽히 숨겨, 구현과 API를 깔끔히 분리한다.**

오직 API를 통해서만 다른 컴포넌트와 소통하며 서로의 내부 동작 방식에는 전혀 개의치 않는다.

이를 자율적인 객체, 또는 정보 은닉(캡슐화)라고 한다.

<br>

### 정보 은닉의 장점

* 시스템 개발 속도를 높인다. 여러 컴포넌트를 병렬로 개발할 수 있기 때문이다.
* 시스템 관리 비용을 낮춘다. 각 컴포넌트를 더 빨리 파악하여 디버깅할 수 있고, 다른 컴포넌트로 교체하는 부담도 적기 때문이다.
* 정보 은닉 자체가 성능을 높여주지는 않지만, 성능 최적화에 도움을 준다.
* 소프트웨어 재사용성을 높인다. 외부에 거의 의존하지 않고 독자적으로 동작할 수 있는 컴포넌트라면 그 컴포넌트와 함께 개발되지 않은 낯선 환경에서도 유용하게 쓰일 가능성이 크기 때문이다.
* 큰 시스템을 제작하는 난이도를 낮춰준다. 시스템 전체가 아직 완성되지 않은 상태에서도 개별 컴포넌트의 동작을 검증할 수 있기 때문이다.

<br>

## 캡슐화 원칙

### 접근 제어자

* private : 멤버를 선언한 톱레벨 클래스에서만 접근할 수 있다. 
* package-private : 멤버가 소속된 패키지 안의 모든 클래스에서 접근할 수 있다. (default)
* protected : package-private의 접근 범위를 포함하며, 이 멤버를 선언한 클래스의 하위 클래스에서도 접근할 수 있다.
* public : 모든 곳에서 접근할 수 있다.

<br>

### 기본 원칙

**모든 클래스와 멤버의 접근성을 가능한 한 좁혀야 한다.**

1. 외부에서 접근 가능한 공개 API를 설계하고 public으로 선언한다.
2. 내부 구현은 private으로 선언한다.
3. 구현 중 같은 패키지의 다른 클래스가 접근해야 한다면 package-private (default)으로 범위를 넓힌다.
   * protected는 가능한 안쓰는 것이 좋지만, 부득이하게 하위 클래스에서 사용해야 하는 경우 사용한다.

<br>

### 공개 API의 제약

공개 API는 영원히 지원되어야 한다. 또, 필요에 따라 문서화되어야 한다. 그러므로 접근 제어는 최대한 좁힐 수 있을 만큼 좁히는 것이 좋다.

> 하지만 리스코프 원칙으로 인해 하위 클래스에서 오버라이딩하면 상위클래스보다 좁혀질 수 없다...

<br>

## public 클래스의 인스턴스 필드는 되도록 public이 아니어야 한다.

* 필드가 가변 객체일 경우, 변경에 취약하다. 
  * final로 해도 불변을 보장하지 못한다.
* 스레드 안전하지 않다.
  * 불변이 아니므로
* public final의 문제점
  * private이면 내부 코드만을 변경하면 되지만, public이면 외부에서도 사용하기 때문에 외부 코드도 변경해줘야 한다.
    * 단, 추상 개념을 완성하는데 필요한 "상수"일 경우에는 사용해도 된다. 기본 타입 또는 불변객체여야 한다.

<br>

**인스턴스 상태로 배열을 사용해야한다면 더더욱 public으로 설정하면 안된다. 배열은 쉽게 외부에서 요소를 변경할 수 있기때문이다.**

만약 꼭 사용해야한다면 아래 두 가지 방식을 이용하는 것이 좋다.

1. 불변 리스트 반환.
   * 상태는 private으로하고, getter를 만들어 `Collections.unmodifiableList`를 반환하는 방식.
2. 방어적 복사.
   * 상태는 private으로하고, getter를 만들어 모든 요소를 복사해서 반환하는 방식.

<br>

## 자바 9부터 도입된 모듈 시스템

* 모듈은 자신이 공개할 패키지를 선언해야 한다.
  * 즉, public, protected여도 공개 대상이 아니면 외부에서 접근할 수 없다.
* jar 패키징 시 module-info를 포함하여 패키징하기 때문에 프로젝트 루트의 classpath에 추가하여도 공개하지 않는 모듈은 접근할 수 없다.

<br>

## 요약

* 프로그램 요소의 접근성을 가능한 한 최소한으로 하라.
* 꼭 필요한 것만 골라 최소한 public API를 설계하자.
  * 그 외에는 모두 내부 구현으로 숨기자.
* public 클래스는 상수용 public static final 필드 외에는 어떠한 public 필드도 가져서는 안된다.
  * public static final 필드가 참조하는 객체가 불변인지 확인하라.