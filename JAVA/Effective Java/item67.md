> 본 자료는 [Effective Java 3/E]()를 바탕으로 작성되었습니다.

# 아이템 67. 최적화는 신중히 하라

<br>

- [아이템 67. 최적화는 신중히 하라](#아이템-67-최적화는-신중히-하라)
  - [최적화 격언 세 개](#최적화-격언-세-개)
  - [빠른 프로그램보다는 좋은 프로그램을 작성하라](#빠른-프로그램보다는-좋은-프로그램을-작성하라)
  - [성능을 아예 신경쓰지 말라는 의미가 아니다.](#성능을-아예-신경쓰지-말라는-의미가-아니다)
  - [각각의 최적화 시도 전후로 성능을 측정하라](#각각의-최적화-시도-전후로-성능을-측정하라)
  - [핵심 정리](#핵심-정리)

<br>

## 최적화 격언 세 개
1. 그 어떤 핑계보다 효율성이라는 이름 아래 행해진 컴퓨팅 죄악이 더 많다. (심지어 효율을 높이지도 못하면서) - 윌리엄 울프
2. (전체의 97% 정도인)자그마한 효율성은 모두 잊자. 섣부른 최적화가 만악의 근원이다. - 도널드 크누스 -
3. 최적화를 할 때는 다음 두 규칙을 따르라. - M.A 잭슨 - 
   * 첫 번째, 하지 마라
   * 두 번째, (전문가 한정) 아직 하지 마라.
   * 완전히 명백하고 최적화되지 않은 해법을 찾을 때까지는 하지 마라.

<br>

> 이 격언들은 자바가 나오기 20년 전부터 나온 말로, 최적화의 어두운 진실을 이야기해준다.
> 
> 최적화는 좋은 결과보다는 해로운 결과로 이어지기 쉽고, 섣불리 진행하면 특히 더 그렇다.

<br>

## 빠른 프로그램보다는 좋은 프로그램을 작성하라
* 성능 때문에 견고한 구조를 희생하지 말라는 의미다.
  * 좋은 프로그램이지만 원하는 성능이 나오지 않는다면 **아키텍처 자체가 최적화할 수 있는 길을 안내**해줄 것이다.
  * 여기서 말하는 **좋은 프로그램이란 은닉 원칙을 잘 따라 개별 구성요소의 내부를 독립적으로 설계할 수 있음을 의미한다.**

<br>

## 성능을 아예 신경쓰지 말라는 의미가 아니다.
* 프로그램을 완성할 때까지 성능 문제를 무시하라는 의미는 아니다.
  * 성능 문제로 인해 완성된 설계의 기본 틀을 변경하려다 보면 유지보수하거나 개선하기 어려운 구조가 나오므로, **설계 단계에서 성능을 반드시 염두에 두어야 한다.**
* **성능을 제한하는 설계를 피해야 한다.**
  * 완성 후에는 변경하기 어려운 시스템인 경우 처음 설계할 때 잘 설계해야 한다.
    * ex. API, 네트워크 프로토콜, 영구 저장용 데이터 포맷등등
* **불변으로 인해 방어적 복사를 할 때도 주의하자**
  * **작은 객체를 몇 개 생성하는 게 큰 부담은 아니지만, 수백만 개를 생성해야 한다면 이야기가 달라진다.**

<br>

> 깨끗하고 명확하고 멋진 구조를 갖춘 프로그램을 완성한 다음에야 최적화를 고려해보자.

<br>

## 각각의 최적화 시도 전후로 성능을 측정하라
* **최적화를 시도한다면 전후로 꼭 성능 측정을 하라.**
  * 자바가 빨라지긴 했지만, 버전마다 성능이 모두 다르고, 코드와 CPU에서 수행하는 명령 사이의 '추상화 격차'가 크므로 항상 성능 측정을 하자.
* **어디서 비용을 많이 쓰는지 확인하고 싶다면 툴을 사용하자. (프로파일링 도구)**
  * 건초더미에서 바늘찾기와 비슷하다. 건초더미가 거대해질수록 금속탐지기가 더 절실해진다.

<br>

## 핵심 정리
* 빠른 프로그램을 작성하려 안달하지 말자.
* 좋은 프로그램을 작성하다 보면 성능을 따라오게 마련이다.
  * 하지만, 시스템을 설계할 때, 특히 API, 네트워크 프로토콜등을 설계할 때는 성능을 염두에 두어야 한다.
* 시스템 구현을 완료했다면 성능을 측정해보자.
  * 문제를 찾지 못했다면 프로파일러를 사용해 문제의 원인을 파악하라.
